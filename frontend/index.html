<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Authentic ESG Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              pistachio: "#DEF4C6",
              mint: "#73E2A7",
              jade: "#1C7C54",
              evergreen: "#1B512D",
            },
            fontFamily: {
              sans: ["Space Grotesk", "ui-sans-serif", "system-ui"],
            },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
      html,
      body {
        margin: 0;
        min-height: 100%;
        color: #1b512d;
        background:
          radial-gradient(1000px 600px at 0% 0%, rgba(115, 226, 167, 0.2) 0%, rgba(115, 226, 167, 0) 70%),
          radial-gradient(900px 500px at 100% 20%, rgba(28, 124, 84, 0.14) 0%, rgba(28, 124, 84, 0) 72%),
          linear-gradient(180deg, #edf9de 0%, #def4c6 48%, #d7efbe 100%);
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image: linear-gradient(rgba(27, 81, 45, 0.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(27, 81, 45, 0.03) 1px, transparent 1px);
        background-size: 42px 42px;
        pointer-events: none;
        z-index: 0;
      }

      #ui-layer {
        position: relative;
        z-index: 1;
      }

      .glass {
        background: rgba(255, 255, 255, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.7);
        box-shadow: 0 10px 24px rgba(27, 81, 45, 0.1);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }

      /* Animated Headline Styles */
      .cd-words-wrapper {
        display: inline-block;
        position: relative;
        text-align: left;
        min-width: 300px;
      }
      .cd-words-wrapper b {
        display: inline-block;
        position: absolute;
        white-space: nowrap;
        left: 0;
        top: 0;
        opacity: 0;
      }
      .cd-words-wrapper b.is-visible {
        position: relative;
        opacity: 1;
      }
      .cd-headline.letters b i {
        display: inline-block;
        position: relative;
        opacity: 0;
      }
      .cd-headline.letters b i.in {
        opacity: 1;
      }
      .cd-headline.letters b i.out {
        opacity: 0;
      }

      /* Typewriter Cursor */
      .cd-words-wrapper::after {
        content: '';
        position: absolute;
        right: -5px;
        top: 5%;
        height: 90%;
        width: 3px;
        background-color: #1b512d;
        animation: cd-pulse 1s infinite;
      }
      @keyframes cd-pulse {
        0% { opacity: 1; }
        50% { opacity: 0; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body>
    <div id="ui-layer">
      <div class="mx-auto w-full max-w-6xl px-4 pb-16 pt-5 sm:px-6 lg:px-8">
        <header class="mb-8 grid gap-6 lg:grid-cols-[1.2fr_0.8fr]">
          <section class="glass relative overflow-hidden rounded-3xl p-6 sm:p-8">
            <div class="relative z-10">
              <p class="text-xs font-semibold uppercase tracking-[0.24em] text-evergreen/75">Greenwashing Detection Platform</p>
              <h1 class="cd-headline letters mt-4 text-4xl font-bold leading-[0.92] text-evergreen sm:text-6xl lg:text-7xl">
                <span class="cd-words-wrapper">
                  <b class="is-visible">Exposing</b>
                  <b>Challenging</b>
                  <b>Investigating</b>
                  <b>Tracking</b>
                </span>
                <br class="sm:hidden" />
                <span class="inline-block">ESG claims.</span>
              </h1>
              <p class="mt-5 max-w-2xl text-sm leading-relaxed text-evergreen/85 sm:text-base">
                Companies make sustainability claims. We verify them. Our platform analyzes disclosures, audits, and independent sources to generate transparent greenwashing risk scores with explainable context.
              </p>
              
            </div>
          </section>

          <section class="glass relative overflow-hidden rounded-3xl p-6 sm:p-8">
            <p class="text-xs font-semibold uppercase tracking-[0.2em] text-evergreen/70">What This Solves</p>
            <ul class="mt-4 space-y-3 text-sm text-evergreen/90 sm:text-base">
              <li>Distinguishes evidence from marketing claims</li>
              <li>Benchmarks statements against known greenwashing patterns</li>
              <li>Provides explainable outputs for analysts and investors</li>
            </ul>

            <!-- Cartoonish Washing Machine -->
            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 opacity-20 lg:opacity-40">
              <svg width="150" height="150" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-evergreen">
                <rect x="8" y="12" width="48" height="44" rx="4" stroke="currentColor" stroke-width="2" fill="white" />
                <circle cx="32" cy="38" r="14" stroke="currentColor" stroke-width="2" />
                <circle cx="32" cy="38" r="10" fill="currentColor" class="opacity-10 animate-pulse" />
                <rect x="12" y="16" width="40" height="6" rx="1" fill="currentColor" class="opacity-10" />
                <circle cx="16" cy="19" r="2" fill="currentColor" />
                <circle cx="22" cy="19" r="2" fill="currentColor" />
                <path d="M28 38C28 35.7909 29.7909 34 32 34" stroke="currentColor" stroke-width="2" stroke-linecap="round" class="origin-center animate-[spin_3s_linear_infinite]" />
              </svg>
            </div>
          </section>
        </header>

        <section id="analyze" class="glass mb-8 rounded-3xl p-6 sm:p-8">
          <h2 class="text-2xl font-bold text-evergreen sm:text-3xl">Company Analysis</h2>
          <p class="mt-2 text-sm text-evergreen/80 sm:text-base">Enter a company name to retrieve greenwashing risk insights.</p>

          <form id="analyze-form" class="mt-5 grid gap-3 sm:grid-cols-[1fr_auto]">
            <input
              type="text"
              name="company"
              required
              placeholder="e.g., GreenCorp"
              class="w-full rounded-xl border border-jade/25 bg-white/70 px-4 py-3 text-sm text-evergreen placeholder-evergreen/50 outline-none focus:border-jade"
            />
            <button type="submit" class="rounded-xl bg-evergreen px-6 py-3 text-sm font-semibold text-pistachio transition hover:bg-jade">Analyze Risk</button>
          </form>
          <label class="mt-3 inline-flex items-center gap-2 text-sm text-evergreen/85">
            <input id="use-discovery" type="checkbox" class="h-4 w-4 rounded border-jade/40 text-jade focus:ring-jade" checked />
            Use OpenAI live discovery (reports + news) before analysis
          </label>

          <p id="analyze-status" class="mt-3 text-sm font-medium text-evergreen"></p>

          <article id="results" class="mt-5 hidden rounded-2xl border border-white/60 bg-white/55 p-4 sm:p-5">
            <div class="flex items-center gap-3">
              <p id="risk-score" class="text-3xl font-bold text-evergreen sm:text-5xl">0<span class="text-base sm:text-lg">/100</span></p>
              <span id="risk-badge" class="rounded-full border px-3 py-1 text-xs font-semibold uppercase tracking-wide">Risk</span>
            </div>
            <p id="risk-explanation" class="mt-4 whitespace-pre-line text-sm leading-relaxed text-evergreen/90 sm:text-base"></p>
            <p class="mt-4 text-xs font-semibold uppercase tracking-wide text-evergreen/70">Matched Greenwashing Patterns</p>
            <ul id="risk-citations" class="mt-4 grid gap-2"></ul>
            <p class="mt-4 text-xs font-semibold uppercase tracking-wide text-evergreen/70">Discovered Sources Used</p>
            <ul id="source-citations" class="mt-2 grid gap-2"></ul>
          </article>
        </section>

        <section id="upload" class="glass mb-8 rounded-3xl p-6 sm:p-8">
          <h2 class="text-2xl font-bold text-evergreen sm:text-3xl">Upload ESG Report</h2>
          <p class="mt-2 text-sm text-evergreen/80 sm:text-base">Upload a `.txt` or `.pdf` ESG document to ingest it into the retrieval system.</p>

          <form id="upload-form" class="mt-5 grid gap-3 sm:grid-cols-2">
            <input
              type="text"
              name="company"
              required
              placeholder="Company name"
              class="w-full rounded-xl border border-jade/25 bg-white/70 px-4 py-3 text-sm text-evergreen placeholder-evergreen/50 outline-none focus:border-jade"
            />
            <select name="sector" class="w-full rounded-xl border border-jade/25 bg-white/70 px-4 py-3 text-sm text-evergreen outline-none focus:border-jade">
              <option>Unknown</option>
              <option>Energy</option>
              <option>Utilities</option>
              <option>Materials</option>
              <option>Industrials</option>
              <option>ConsumerDiscretionary</option>
              <option>ConsumerStaples</option>
              <option>HealthCare</option>
              <option>Financials</option>
              <option>InformationTechnology</option>
              <option>CommunicationServices</option>
              <option>RealEstate</option>
              <option>Other</option>
            </select>
            <select name="doc_type" class="w-full rounded-xl border border-jade/25 bg-white/70 px-4 py-3 text-sm text-evergreen outline-none focus:border-jade">
              <option>ESGReport</option>
              <option>AnnualReport</option>
              <option>SustainabilityReport</option>
              <option>ClimateReport</option>
              <option>ImpactReport</option>
              <option>CSRReport</option>
              <option>Other</option>
            </select>
            <input
              type="file"
              name="file"
              accept=".txt,.pdf"
              required
              class="w-full rounded-xl border border-jade/25 bg-white/70 px-4 py-3 text-sm text-evergreen outline-none file:mr-4 file:rounded-lg file:border-0 file:bg-evergreen file:px-3 file:py-2 file:text-xs file:font-semibold file:text-pistachio hover:file:bg-jade"
            />
            <button type="submit" class="rounded-xl bg-evergreen px-6 py-3 text-sm font-semibold text-pistachio transition hover:bg-jade sm:col-span-2">Upload & Ingest</button>
          </form>

          <p id="upload-status" class="mt-3 text-sm font-medium text-evergreen"></p>
        </section>

        <section class="glass mb-8 rounded-3xl p-6 sm:p-8">
          <p class="text-xs font-semibold uppercase tracking-[0.2em] text-evergreen/70">The Greenwashing Problem</p>
          <h2 class="mt-2 text-2xl font-bold text-evergreen sm:text-3xl">Why It Matters</h2>
          <p class="mt-3 max-w-3xl text-sm leading-relaxed text-evergreen/85 sm:text-base">
            Greenwashing happens when companies overstate environmental progress or hide critical context. It creates false confidence for investors,
            weakens trust in ESG reporting, and can redirect capital away from genuinely sustainable businesses.
          </p>
          <div class="mt-5 grid gap-3 sm:grid-cols-3">
            <article class="rounded-2xl border border-white/60 bg-white/45 p-4">
              <p class="text-xs font-semibold uppercase tracking-wide text-evergreen/70">Misleading Claims</p>
              <p class="mt-2 text-sm text-evergreen/90">Broad “eco-friendly” statements without measurable evidence.</p>
            </article>
            <article class="rounded-2xl border border-white/60 bg-white/45 p-4">
              <p class="text-xs font-semibold uppercase tracking-wide text-evergreen/70">Selective Reporting</p>
              <p class="mt-2 text-sm text-evergreen/90">Highlighting wins while omitting high-impact emissions data.</p>
            </article>
            <article class="rounded-2xl border border-white/60 bg-white/45 p-4">
              <p class="text-xs font-semibold uppercase tracking-wide text-evergreen/70">Weak Verification</p>
              <p class="mt-2 text-sm text-evergreen/90">Claims not backed by peer comparisons or source evidence.</p>
            </article>
          </div>
        </section>

       
      </div>
    </div>

    <script>
      const API_URL = window.location.origin;

      const form = document.getElementById("analyze-form");
      const uploadForm = document.getElementById("upload-form");
      const statusEl = document.getElementById("analyze-status");
      const uploadStatusEl = document.getElementById("upload-status");
      const useDiscoveryEl = document.getElementById("use-discovery");
      const resultsEl = document.getElementById("results");
      const scoreEl = document.getElementById("risk-score");
      const badgeEl = document.getElementById("risk-badge");
      const explanationEl = document.getElementById("risk-explanation");
      const citationsEl = document.getElementById("risk-citations");
      const sourceCitationsEl = document.getElementById("source-citations");

      function setStatus(message, isError = false) {
        statusEl.textContent = message;
        statusEl.className = `mt-3 text-sm font-medium ${isError ? "text-red-700" : "text-evergreen"}`;
      }

      function setUploadStatus(message, isError = false) {
        uploadStatusEl.textContent = message;
        uploadStatusEl.className = `mt-3 text-sm font-medium ${isError ? "text-red-700" : "text-evergreen"}`;
      }

      function riskMeta(score) {
        if (score > 60) return { label: "High Risk", classes: "border-red-700 text-red-700" };
        if (score > 30) return { label: "Medium Risk", classes: "border-amber-700 text-amber-700" };
        return { label: "Low Risk", classes: "border-jade text-jade" };
      }

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const company = String(new FormData(form).get("company") || "").trim();
        if (!company) {
          setStatus("Please enter a company name.", true);
          return;
        }

        setStatus("Running analysis...");
        resultsEl.classList.add("hidden");

        try {
          if (useDiscoveryEl.checked) {
            setStatus("Discovering latest reports and news with OpenAI...");
            const controller = new AbortController();
            const timeoutMs = 45000;
            const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
            let discoverResp;
            let discoverPayload;
            try {
              discoverResp = await fetch(`${API_URL}/discover/${encodeURIComponent(company)}?max_results=8`, {
                method: "POST",
                signal: controller.signal,
              });
              discoverPayload = await discoverResp.json().catch(() => ({}));
            } catch (discoverError) {
              if (discoverError && discoverError.name === "AbortError") {
                setStatus("Discovery timed out after 45s. You can run analysis on existing docs or retry.", true);
                return;
              }
              throw discoverError;
            } finally {
              clearTimeout(timeoutId);
            }
            if (!discoverResp.ok) {
              setStatus(
                discoverPayload.detail
                  ? `Discovery failed: ${String(discoverPayload.detail)}`
                  : `Discovery failed (${discoverResp.status}).`,
                true,
              );
              return;
            }
            const discovered = Number(discoverPayload.discovered || 0);
            const ingested = Number(discoverPayload.ingested || 0);
            const errors = Array.isArray(discoverPayload.errors) ? discoverPayload.errors : [];
            if (errors.length > 0) {
              setStatus(
                `Discovery warning (${discovered} found, ${ingested} ingested): ${errors[0]}. If this mentions rate limits, check OpenAI billing/quota.`,
                false,
              );
            } else {
              setStatus(`Discovery complete: ${discovered} found, ${ingested} ingested.`);
            }
          }

          setStatus("Running analysis...");
          const response = await fetch(`${API_URL}/analyze/${encodeURIComponent(company)}`);
          const payload = await response.json().catch(() => ({}));

          if (!response.ok) {
            setStatus(payload.detail ? String(payload.detail) : `Request failed (${response.status}).`, true);
            return;
          }

          const score = Number(payload.risk_score || 0);
          const meta = riskMeta(score);

          scoreEl.innerHTML = `${score.toFixed(2)}<span class="text-base sm:text-lg">/100</span>`;
          badgeEl.textContent = meta.label;
          badgeEl.className = `rounded-full border px-3 py-1 text-xs font-semibold uppercase tracking-wide ${meta.classes}`;
          explanationEl.textContent = String(payload.explanation || "No explanation returned.");
          if (payload.status === "no_data") {
            explanationEl.textContent = `${String(payload.explanation || "No data found.")}\n\nNo risk score can be computed until documents are ingested.`;
          }

          citationsEl.innerHTML = "";
          const citations = Array.isArray(payload.citations) ? payload.citations : [];
          for (const citation of citations) {
            const li = document.createElement("li");
            li.className = "rounded-xl border border-white/60 bg-white/45 p-3 text-sm text-evergreen/90";
            li.textContent = `Similarity ${Number(citation.similarity || 0).toFixed(3)}: ${String(citation.content || "")}`;
            citationsEl.appendChild(li);
          }
          if (citations.length === 0) {
            const li = document.createElement("li");
            li.className = "rounded-xl border border-white/60 bg-white/45 p-3 text-sm text-evergreen/80";
            li.textContent = "No matched greenwashing pattern citations found.";
            citationsEl.appendChild(li);
          }

          sourceCitationsEl.innerHTML = "";
          const sources = Array.isArray(payload.source_citations) ? payload.source_citations : [];
          for (const source of sources) {
            const li = document.createElement("li");
            li.className = "rounded-xl border border-white/60 bg-white/45 p-3 text-sm text-evergreen/90";
            const title = String(source.title || "Untitled source");
            const publisher = String(source.publisher || "Unknown publisher");
            const published = String(source.published_at || "").trim();
            const url = String(source.url || "");
            const titleP = document.createElement("p");
            titleP.className = "font-semibold";
            titleP.textContent = title;
            li.appendChild(titleP);

            const metaP = document.createElement("p");
            metaP.className = "text-xs text-evergreen/70";
            metaP.textContent = published ? `${publisher} • ${published}` : publisher;
            li.appendChild(metaP);

            if (url) {
              const link = document.createElement("a");
              link.className = "mt-1 inline-block text-xs underline";
              link.href = url;
              link.target = "_blank";
              link.rel = "noreferrer";
              link.textContent = "View source";
              li.appendChild(link);
            }
            sourceCitationsEl.appendChild(li);
          }
          if (sources.length === 0) {
            const li = document.createElement("li");
            li.className = "rounded-xl border border-white/60 bg-white/45 p-3 text-sm text-evergreen/80";
            li.textContent = "No discovered source citations available yet. Enable live discovery and analyze again.";
            sourceCitationsEl.appendChild(li);
          }

          resultsEl.classList.remove("hidden");
          setStatus(`Analysis complete for ${payload.company || company}.`);
        } catch (error) {
          setStatus(`Unable to complete analysis: ${String(error)}`, true);
        }
      });

      uploadForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        const formData = new FormData(uploadForm);
        const company = String(formData.get("company") || "").trim();
        const file = formData.get("file");

        if (!company) {
          setUploadStatus("Please enter a company name.", true);
          return;
        }
        if (!(file instanceof File) || file.size === 0) {
          setUploadStatus("Please select a .txt or .pdf file.", true);
          return;
        }

        setUploadStatus("Uploading and ingesting report...");
        try {
          const response = await fetch(`${API_URL}/upload/esg`, {
            method: "POST",
            body: formData,
          });
          const payload = await response.json().catch(() => ({}));

          if (!response.ok) {
            setUploadStatus(payload.detail ? String(payload.detail) : `Upload failed (${response.status}).`, true);
            return;
          }

          setUploadStatus(`Upload complete: ${payload.saved_as || "ingested"}.`);
          uploadForm.reset();
        } catch (error) {
          setUploadStatus(`Unable to upload: ${String(error)}`, true);
        }
      });

      // Animated Headline Logic
      jQuery(document).ready(function($) {
        var animationDelay = 1500, // pause between words
          typeSpeed = 40,
          backspaceSpeed = 30;

        initHeadline();

        function initHeadline() {
          singleLetters($('.cd-headline.letters').find('b'));
          animateHeadline($('.cd-headline'));
        }

        function singleLetters($words) {
          $words.each(function() {
            var word = $(this),
              letters = word.text().split(''),
              selected = word.hasClass('is-visible');
            for (var i in letters) {
              letters[i] = (selected) ? '<i class="in">' + letters[i] + '</i>' : '<i>' + letters[i] + '</i>';
            }
            var newLetters = letters.join('');
            word.html(newLetters);
          });
        }

        function animateHeadline($headlines) {
          var duration = animationDelay;
          $headlines.each(function() {
            var headline = $(this);
            setTimeout(function() { hideWord(headline.find('.is-visible').eq(0)) }, duration);
          });
        }

        function hideWord($word) {
          var nextWord = takeNext($word);
          // Hide letters right-to-left
          hideLetter($word.find('i').last(), $word, nextWord, backspaceSpeed);
        }

        function hideLetter($letter, $oldWord, $newWord, $duration) {
          $letter.removeClass('in').addClass('out');
          if (!$letter.is(':first-child')) {
            setTimeout(function() { hideLetter($letter.prev(), $oldWord, $newWord, $duration); }, $duration);
          } else {
            // All letters hidden, switch word and start typing
            setTimeout(function() {
              $oldWord.removeClass('is-visible').addClass('is-hidden');
              $newWord.removeClass('is-hidden').addClass('is-visible');
              showLetter($newWord.find('i').first(), $oldWord, $newWord, typeSpeed);
            }, 300);
          }
        }

        function showLetter($letter, $oldWord, $newWord, $duration) {
          $letter.addClass('in').removeClass('out');
          if (!$letter.is(':last-child')) {
            setTimeout(function() { showLetter($letter.next(), $oldWord, $newWord, $duration); }, $duration);
          } else {
            // Word is typed, pause and repeat
            setTimeout(function() { animateHeadline($oldWord.parents('.cd-headline')) }, animationDelay);
          }
        }

        function takeNext($word) {
          return (!$word.is(':last-child')) ? $word.next() : $word.parent().children().eq(0);
        }
      });
    </script>
  </body>
</html>
